---
id: initial-setup
title: Initial Setup
sidebar_label: Initial Setup
keywords: ["create", "custom", "application", "graphql", "react", "authentication"]
description: Learn how to implement authentication in your custom React application.
---

import CenteredImage from "@components/CenteredImage";

:::tip WHAT YOUâ€™LL LEARN

- how to implement authentication in your custom application

:::

:::info Can I use this?

In order to follow this tutorial, you must use Webiny version **5.13.0** or greater.

:::

Add a couple of new libraries: [`@webiny/app-security`](https://www.npmjs.com/package/@webiny/app-security) and [`@aws-amplify/auth`](https://www.npmjs.com/package/@aws-amplify/auth).


```bash
yarn workspace pinterest-clone-app add @webiny/app-security @aws-amplify/auth
```

```tsx title="pinterest-clone/app/code/src/App.tsx" {5,6,22-23,33-34}
import React from "react";
import { ApolloProvider } from "@apollo/react-components";
import { Routes } from "@webiny/app/components/Routes";
import { BrowserRouter } from "@webiny/react-router";
import { SecurityProvider } from "@webiny/app-security";
import Authenticator from "./components/Authenticator";
import { createApolloClient } from "./apollo";

// An entrypoint for all SCSS styles your application might have.
import "./App.scss";
import "antd/dist/antd.css";

// The beginning of our React application, where we mount a couple of useful providers.
// If needed, feel free to add new or modify existing providers.
export const App = () => (
    <>
        {/*
            <SecurityProvider> is a generic provider of identity information. 3rd party identity providers (like Cognito,
            Okta, Auth0) will handle the authentication, and set the information about the user into this provider,
            so other parts of the system have a centralized place to fetch user information from.
        */}
        <SecurityProvider>
            <Authenticator>
                {/* Sets up a new Apollo GraphQL client, pointed to an existing GraphQL API. */}
                <ApolloProvider
                    client={createApolloClient({ uri: process.env.REACT_APP_GRAPHQL_API_URL })}
                >
                    {/* Enables routing in our application. */}
                    <BrowserRouter basename={process.env.PUBLIC_URL}>
                        <Routes />
                    </BrowserRouter>
                </ApolloProvider>
            </Authenticator>
        </SecurityProvider>
    </>
);
```

```tsx title="pinterest-clone/app/code/src/components/Authenticator.tsx"
import React, { useEffect } from "react";
import Auth from "@aws-amplify/auth";
import { useSecurity, SecurityIdentity } from "@webiny/app-security";

Auth.configure({
    region: process.env.REACT_APP_USER_POOL_REGION,
    userPoolId: process.env.REACT_APP_USER_POOL_ID,
    userPoolWebClientId: process.env.REACT_APP_USER_POOL_WEB_CLIENT_ID,
    oauth: {
        domain: process.env.REACT_APP_USER_POOL_DOMAIN,
        redirectSignIn: `${location.origin}?signIn`,
        redirectSignOut: `${location.origin}?signOut`,
        responseType: "token"
    }
});

/**
 * The default layout component which you can use on any page.
 * Feel free to customize it or create additional layout components.
 */
const Authenticator: React.FC = props => {
    const { setIdentity } = useSecurity();

    useEffect(() => {
        Auth.currentSession().then(response => {
            const user = response.getIdToken().payload;
            setIdentity(
                new SecurityIdentity({
                    login: user.email,
                    firstName: user.given_name,
                    lastName: user.family_name,
                    logout: () => {
                        Auth.signOut();
                        setIdentity(null);
                    }
                })
            );
        });
    }, []);

    return <>{props.children}</>;
};

export default Authenticator;
```

```ts title="pinterest-clone/app/code/src/plugins/apollo.ts" {5,6,18-32}
import { ConsoleLinkPlugin } from "@webiny/app/plugins/ConsoleLinkPlugin";
import { NetworkErrorLinkPlugin } from "@webiny/app/plugins/NetworkErrorLinkPlugin";
import { OmitTypenameLinkPlugin } from "@webiny/app/plugins/OmitTypenameLinkPlugin";
import { ApolloLinkPlugin } from "@webiny/app/plugins/ApolloLinkPlugin";
import { setContext } from "apollo-link-context";
import { Auth } from "@aws-amplify/auth";

export default [
    // This link removes `__typename` from the variables being sent to the API.
    new OmitTypenameLinkPlugin(),

    // This link checks for presence of `extensions.console` in the response and logs all items to browser console.
    new ConsoleLinkPlugin(),

    // This plugin creates an ApolloLink that checks for `NetworkError` and shows an ErrorOverlay in the browser.
    new NetworkErrorLinkPlugin(),

    new ApolloLinkPlugin(() => {
        return setContext(async (_, { headers }) => {
            try {
                const user = await Auth.currentSession();
                return {
                    headers: {
                        ...headers,
                        Authorization: user.getIdToken().getJwtToken()
                    }
                };
            } catch (error) {
                return { headers };
            }
        });
    })
];
```
